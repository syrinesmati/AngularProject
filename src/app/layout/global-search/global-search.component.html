<div class="relative">
  <div
    (click)="openSearch()"
    class="flex items-center gap-2 px-3 py-2 rounded-lg border border-border bg-background cursor-pointer transition-all"
    [ngClass]="isOpen() ? 'ring-2 ring-ring w-80' : 'w-64 hover:border-muted-foreground/40'"
  >
    <lucide-icon name="Search" [size]="16" class="text-muted-foreground"></lucide-icon>
    @if (isOpen()) {
    <input
      type="text"
      [(ngModel)]="query"
      (ngModelChange)="onQueryChange($event)"
      placeholder="Search tasks, projects..."
      class="border-0 p-0 h-auto focus:outline-none focus:ring-0 bg-transparent w-full"
      autofocus
    />
    @if (query()) {
    <button (click)="closeSearch()" class="ml-auto">
      <lucide-icon
        name="x"
        [size]="16"
        class="text-muted-foreground hover:text-foreground"
      ></lucide-icon>
    </button>
    } } @else {
    <span class="text-sm text-muted-foreground">Search tasks, projects...</span>
    <kbd
      class="ml-auto pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground"
    >
      <span class="text-xs">âŒ˜</span>K
    </kbd>
    }
  </div>

  @if (isOpen() && query().length > 1) {
  <div
    class="absolute top-full mt-2 w-80 rounded-lg border border-border bg-popover shadow-lg max-h-96 overflow-y-auto"
  >
    @if (hasResults) {
    <!-- Projects Results -->
    @if (projects.length > 0) {
    <div class="p-2">
      <p class="px-2 py-1.5 text-xs font-medium text-muted-foreground">Projects</p>
      @for (project of projects; track project.id) {
      <button
        (click)="selectProject(project.id)"
        class="flex w-full items-center gap-2 rounded-sm px-2 py-2 text-sm hover:bg-accent transition-colors"
      >
        <lucide-icon name="folder-open" [size]="16" class="text-muted-foreground"></lucide-icon>
        <span>{{ project.name }}</span>
      </button>
      }
    </div>
    }

    <!-- Tasks Results -->
    @if (tasks.length > 0) {
    <div class="p-2 border-t border-border">
      <p class="px-2 py-1.5 text-xs font-medium text-muted-foreground">Tasks</p>
      @for (task of tasks; track task.id) {
      <button
        (click)="selectTask(task.id)"
        class="flex w-full items-center gap-2 rounded-sm px-2 py-2 text-sm hover:bg-accent transition-colors"
      >
        <lucide-icon name="file-text" [size]="16" class="text-muted-foreground"></lucide-icon>
        <span>{{ task.title }}</span>
      </button>
      }
    </div>
    } } @else {
    <div class="p-8 text-center">
      <lucide-icon name="Search" [size]="32" class="mx-auto text-muted-foreground/50"></lucide-icon>
      <p class="mt-2 text-sm text-muted-foreground">No results found</p>
      <p class="text-xs text-muted-foreground">Try searching for something else</p>
    </div>
    }
  </div>
  }
</div>
